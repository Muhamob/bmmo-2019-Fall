На Е-шаге вычисляется апостериорное распределение на координаты лица на изображениях:
\begin{gather*}
q(d) = p(d | X, \theta, A) = \prod_k (d_k | X_k, \theta, A) = \prod_k q_k(d_k)
\end{gather*}

Распишем подробнее $q_k(d_k)$:
\import{./}{update_q.tex}

Здесь для избежания ошибок округления использован трюк с логарифмированием и вычетом максимального значения